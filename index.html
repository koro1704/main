<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faculty Finder</title>
    <!-- Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for a clean look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Ionicons for better iconography -->
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <!-- Custom styles -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Lighter gray background */
        }
        /* Page transition animation */
        .page {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }
        /* Custom styling for status badges */
        .status-available {
            background-color: #dcfce7;
            color: #166534;
            border: 1px solid #4ade80;
        }
        .status-not-available {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #f87171;
        }
        /* Modal styles */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.6);
            animation: fadeIn 0.3s ease-out;
            z-index: 50;
        }
        .modal-box {
            animation: fadeIn 0.3s ease-out;
            transform: translateY(-20px);
            transition: transform 0.3s;
        }
    </style>
</head>
<body class="antialiased text-gray-900">

    <!-- Main Container -->
    <div id="app" class="min-h-screen flex flex-col items-center justify-center p-4">

        <!-- Login Page -->
        <div id="login-page" class="page w-full max-w-4xl">
            <div class="text-center mb-12">
                <h1 class="text-4xl md:text-5xl font-bold text-slate-800">Faculty Finder</h1>
                <p class="text-lg text-slate-500 mt-2">Your central hub for campus faculty information.</p>
            </div>
            <div class="grid md:grid-cols-3 gap-8">
                <!-- Student Login Card -->
                <div id="student-portal-card" class="bg-white p-8 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 cursor-pointer">
                    <div class="text-center">
                        <div class="mx-auto flex items-center justify-center h-20 w-20 rounded-full bg-blue-100 mb-4">
                            <ion-icon name="school-outline" class="text-4xl text-blue-600"></ion-icon>
                        </div>
                        <h2 class="text-2xl font-semibold text-gray-800">Student Portal</h2>
                        <p class="text-gray-500 mt-2">Check professor availability and locations.</p>
                    </div>
                </div>
                <!-- Teacher Login Card -->
                <div id="teacher-portal-card" class="bg-white p-8 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 cursor-pointer">
                    <div class="text-center">
                        <div class="mx-auto flex items-center justify-center h-20 w-20 rounded-full bg-green-100 mb-4">
                            <ion-icon name="person-circle-outline" class="text-4xl text-green-600"></ion-icon>
                        </div>
                        <h2 class="text-2xl font-semibold text-gray-800">Teacher Portal</h2>
                        <p class="text-gray-500 mt-2">Update status and view colleague details.</p>
                    </div>
                </div>
                <!-- Admin Login Card -->
                <div id="admin-portal-card" class="bg-white p-8 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 cursor-pointer">
                    <div class="text-center">
                        <div class="mx-auto flex items-center justify-center h-20 w-20 rounded-full bg-indigo-100 mb-4">
                            <ion-icon name="settings-outline" class="text-4xl text-indigo-600"></ion-icon>
                        </div>
                        <h2 class="text-2xl font-semibold text-gray-800">Admin Portal</h2>
                        <p class="text-gray-500 mt-2">Manage all faculty data and settings.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Login Form Pages -->
        <div id="teacher-login-page" class="page w-full max-w-md bg-white p-8 rounded-xl shadow-lg"></div>
        <div id="admin-login-page" class="page w-full max-w-md bg-white p-8 rounded-xl shadow-lg"></div>

        <!-- Student Dashboard -->
        <div id="student-dashboard" class="page w-full max-w-5xl bg-white p-8 rounded-xl shadow-lg">
             <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                <h2 class="text-3xl font-bold text-gray-800">Faculty Directory</h2>
                <button onclick="actions.showPage('login-page')" class="bg-slate-200 text-slate-700 px-4 py-2 rounded-lg hover:bg-slate-300 transition-colors flex items-center gap-2"><ion-icon name="arrow-back-outline"></ion-icon>Go Back</button>
            </div>
            <div class="mb-4">
                <input type="text" id="student-search" onkeyup="render.studentDashboard()" placeholder="Search by name or department..." class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div id="student-professor-list" class="space-y-4"></div>
        </div>
        
        <!-- Teacher Dashboard -->
        <div id="teacher-dashboard" class="page w-full max-w-5xl bg-white p-8 rounded-xl shadow-lg">
            <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                <div>
                    <h2 class="text-3xl font-bold text-gray-800">Teacher Dashboard</h2>
                    <p id="teacher-welcome" class="text-gray-600 mt-1"></p>
                </div>
                <div class="flex items-center gap-2">
                     <button onclick="actions.openModal('editProfile')" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2"><ion-icon name="create-outline"></ion-icon>Edit My Profile</button>
                    <button onclick="actions.openModal('confirmLogout')" class="bg-slate-200 text-slate-700 px-4 py-2 rounded-lg hover:bg-slate-300 transition-colors flex items-center gap-2"><ion-icon name="log-out-outline"></ion-icon>Logout</button>
                </div>
            </div>
            <div id="teacher-professor-list" class="overflow-x-auto"></div>
        </div>

        <!-- Admin Dashboard -->
        <div id="admin-dashboard" class="page w-full max-w-6xl bg-white p-8 rounded-xl shadow-lg">
             <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                <h2 class="text-3xl font-bold text-gray-800">Admin Control Panel</h2>
                <div class="flex items-center gap-2">
                    <button onclick="actions.openModal('addProfessor')" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors flex items-center gap-2"><ion-icon name="add-outline"></ion-icon>Add Professor</button>
                    <button onclick="actions.openModal('confirmLogout')" class="bg-slate-200 text-slate-700 px-4 py-2 rounded-lg hover:bg-slate-300 transition-colors flex items-center gap-2"><ion-icon name="log-out-outline"></ion-icon>Logout</button>
                </div>
            </div>
            <div id="admin-professor-list" class="overflow-x-auto"></div>
        </div>
    </div>

    <!-- Modal Container -->
    <div id="modal-container" class="modal-overlay hidden items-center justify-center p-4">
        <div id="modal-box" class="modal-box bg-white rounded-xl shadow-2xl w-full max-w-md">
            <!-- Modal content is injected here -->
        </div>
    </div>

    <!-- REBUILT JAVASCRIPT LOGIC -->
    <script>
        // =================================================================================
        // 1. STATE MANAGEMENT
        // All application data is stored here. Functions read from and write to this object.
        // =================================================================================
        const state = {
            currentPage: 'login-page',
            loggedInUser: null, // Can be a professor object or 'admin'
            professors: [
                { id: 1, name: 'Dr. Evelyn Reed', department: 'Computer Science', cabin: 'A-101', status: 'Available', password: 'password123' },
                { id: 2, name: 'Dr. Samuel Chen', department: 'Physics', cabin: 'B-205', status: 'Not Available', password: 'password123' },
                { id: 3, name: 'Dr. Maria Garcia', department: 'Chemistry', cabin: 'C-310', status: 'Available', password: 'password123' },
                { id: 4, name: 'Dr. Ben Carter', department: 'Mathematics', cabin: 'A-102', status: 'Available', password: 'password123' },
                { id: 5, name: 'Dr. Aisha Khan', department: 'Computer Science', cabin: 'D-401', status: 'Not Available', password: 'password123' }
            ],
            nextProfId: 6,
            adminCredentials: { name: 'admin', password: 'admin' },
        };

        // =================================================================================
        // 2. RENDER FUNCTIONS
        // These functions are responsible for drawing the UI based on the current state.
        // They ONLY read from the `state` object.
        // =================================================================================
        const render = {
            // Main render function: hides/shows pages and calls specific renderers
            app: () => {
                document.querySelectorAll('.page').forEach(page => page.style.display = 'none');
                const pageToShow = document.getElementById(state.currentPage);
                if (pageToShow) pageToShow.style.display = 'block';

                switch (state.currentPage) {
                    case 'student-dashboard':
                        render.studentDashboard();
                        break;
                    case 'teacher-dashboard':
                        render.teacherDashboard();
                        break;
                    case 'admin-dashboard':
                        render.adminDashboard();
                        break;
                    case 'teacher-login-page':
                        document.getElementById('teacher-login-page').innerHTML = render.loginForm('teacher');
                        document.getElementById('teacher-login-form').addEventListener('submit', (e) => actions.handleLogin(e, 'teacher'));
                        break;
                    case 'admin-login-page':
                        document.getElementById('admin-login-page').innerHTML = render.loginForm('admin');
                        document.getElementById('admin-login-form').addEventListener('submit', (e) => actions.handleLogin(e, 'admin'));
                        break;
                }
            },

            loginForm: (type) => {
                const isTeacher = type === 'teacher';
                const title = isTeacher ? 'Teacher Login' : 'Admin Login';
                const placeholder = isTeacher ? 'e.g., Dr. Evelyn Reed' : 'admin';
                const accentColor = isTeacher ? 'green' : 'indigo';
                return `
                    <h2 class="text-3xl font-bold text-gray-800 text-center mb-6">${title}</h2>
                    <form id="${type}-login-form" class="space-y-6">
                        <div>
                            <label for="${type}-login-name" class="block text-sm font-medium text-gray-700">Name</label>
                            <input type="text" id="${type}-login-name" placeholder="${placeholder}" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-${accentColor}-500 focus:border-${accentColor}-500">
                        </div>
                        <div>
                            <label for="${type}-login-password" class="block text-sm font-medium text-gray-700">Password</label>
                            <input type="password" id="${type}-login-password" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-${accentColor}-500 focus:border-${accentColor}-500">
                            ${isTeacher ? `<p class="text-xs text-gray-500 mt-1">Hint: The password for all users is 'password123'.</p>` : ''}
                        </div>
                        <div id="${type}-login-error" class="text-red-500 text-sm text-center min-h-[1.25rem]"></div>
                        <button type="submit" class="w-full bg-${accentColor}-500 text-white px-6 py-3 rounded-lg hover:bg-${accentColor}-600 transition-colors font-semibold">Login</button>
                    </form>
                    <button onclick="actions.showPage('login-page')" class="w-full mt-4 bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300 transition-colors">Go Back</button>
                `;
            },

            studentDashboard: () => {
                const list = document.getElementById('student-professor-list');
                const searchTerm = document.getElementById('student-search').value.toLowerCase();
                const filtered = state.professors.filter(p => p.name.toLowerCase().includes(searchTerm) || p.department.toLowerCase().includes(searchTerm));
                list.innerHTML = filtered.length ? filtered.map(prof => `
                    <div class="grid grid-cols-3 md:grid-cols-4 gap-4 items-center bg-slate-50 p-4 rounded-lg border border-slate-200">
                        <div><p class="font-bold text-lg">${prof.name}</p><p class="text-sm text-gray-600">${prof.department}</p></div>
                        <div class="text-center text-gray-700 hidden md:block">${prof.cabin}</div>
                        <div class="text-center"><span class="px-3 py-1 text-sm font-medium rounded-full ${prof.status === 'Available' ? 'status-available' : 'status-not-available'}">${prof.status}</span></div>
                        <div class="text-center text-gray-700 md:hidden">${prof.cabin}</div>
                    </div>`).join('') : `<p class="text-center text-gray-500 py-4">No professors found.</p>`;
            },

            teacherDashboard: () => {
                if (!state.loggedInUser) return;
                document.getElementById('teacher-welcome').textContent = `Welcome, ${state.loggedInUser.name}!`;
                const container = document.getElementById('teacher-professor-list');
                const headers = ['Name', 'Department', 'Cabin', 'Status'];
                const rows = state.professors.map(prof => `
                    <tr class="border-b border-gray-200 hover:bg-slate-50 ${prof.id === state.loggedInUser.id ? 'bg-blue-50 font-bold' : ''}">
                        <td class="py-3 px-4">${prof.name}</td>
                        <td class="py-3 px-4">${prof.department}</td>
                        <td class="py-3 px-4">${prof.cabin}</td>
                        <td class="py-3 px-4"><span class="px-3 py-1 text-sm font-medium rounded-full ${prof.status === 'Available' ? 'status-available' : 'status-not-available'}">${prof.status}</span></td>
                    </tr>`).join('');
                container.innerHTML = `<table class="min-w-full bg-white"><thead class="bg-slate-100"><tr>${headers.map(h => `<th class="text-left py-3 px-4 font-semibold text-sm">${h}</th>`).join('')}</tr></thead><tbody class="text-gray-700">${rows}</tbody></table>`;
            },

            adminDashboard: () => {
                const container = document.getElementById('admin-professor-list');
                const headers = ['Name', 'Department', 'Cabin', 'Status', 'Actions'];
                const rows = state.professors.map(prof => `
                    <tr class="border-b border-gray-200">
                        <td class="py-3 px-4">${prof.name}</td>
                        <td class="py-3 px-4">${prof.department}</td>
                        <td class="py-3 px-4">${prof.cabin}</td>
                        <td class="py-3 px-4"><span class="px-3 py-1 text-sm font-medium rounded-full ${prof.status === 'Available' ? 'status-available' : 'status-not-available'}">${prof.status}</span></td>
                        <td class="py-3 px-4 flex items-center gap-2">
                            <button onclick="actions.openModal('editProfessor', ${prof.id})" class="text-blue-600 hover:text-blue-800"><ion-icon name="create-outline" class="text-xl"></ion-icon></button>
                            <button onclick="actions.openModal('confirmDelete', ${prof.id})" class="text-red-600 hover:text-red-800"><ion-icon name="trash-outline" class="text-xl"></ion-icon></button>
                        </td>
                    </tr>`).join('');
                container.innerHTML = `<table class="min-w-full bg-white"><thead class="bg-slate-100"><tr>${headers.map(h => `<th class="text-left py-3 px-4 font-semibold text-sm">${h}</th>`).join('')}</tr></thead><tbody class="text-gray-700">${rows}</tbody></table>`;
            },

            // Renders the content INSIDE the modal
            modalContent: (type, id = null) => {
                const modalBox = document.getElementById('modal-box');
                let content = '';
                const prof = id ? state.professors.find(p => p.id === id) : null;

                switch (type) {
                    case 'confirmLogout':
                        content = `<div class="p-6 text-center"><h3 class="text-xl font-semibold mb-4">Confirm Logout</h3><p class="text-gray-600 mb-6">Are you sure you want to log out?</p><div class="flex justify-center gap-4"><button onclick="actions.closeModal()" class="px-6 py-2 rounded-lg bg-gray-200 hover:bg-gray-300">Cancel</button><button onclick="actions.logout()" class="px-6 py-2 rounded-lg bg-red-500 text-white hover:bg-red-600">Logout</button></div></div>`;
                        break;
                    case 'success':
                        content = `<div class="p-6 text-center"><ion-icon name="checkmark-circle-outline" class="text-5xl text-green-500 mx-auto mb-4"></ion-icon><h3 class="text-xl font-semibold mb-4">Success!</h3><p class="text-gray-600 mb-6">${id}</p><button onclick="actions.closeModal()" class="px-6 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600">OK</button></div>`;
                        break;
                    case 'confirmDelete':
                        if (!prof) return; // Safeguard
                        content = `<div class="p-6 text-center"><h3 class="text-xl font-semibold mb-4">Delete Professor</h3><p class="text-gray-600 mb-6">Are you sure you want to delete ${prof.name}?</p><div class="flex justify-center gap-4"><button onclick="actions.closeModal()" class="px-6 py-2 rounded-lg bg-gray-200 hover:bg-gray-300">Cancel</button><button onclick="actions.deleteProfessor(${id})" class="px-6 py-2 rounded-lg bg-red-500 text-white hover:bg-red-600">Delete</button></div></div>`;
                        break;
                    case 'addProfessor':
                    case 'editProfessor':
                    case 'editProfile':
                        const isEditing = type !== 'addProfessor';
                        const isTeacherEditing = type === 'editProfile';
                        const professorData = isTeacherEditing ? state.loggedInUser : prof;
                        const title = isTeacherEditing ? 'Edit Your Profile' : (isEditing ? 'Edit Professor' : 'Add New Professor');
                        const buttonText = isEditing ? 'Save Changes' : 'Add Professor';
                        const handler = isTeacherEditing ? 'actions.handleProfessorUpdate(event, true)' : 'actions.handleProfessorUpdate(event)';
                        
                        content = `<div class="p-6"><h3 class="text-xl font-semibold mb-6">${title}</h3><form onsubmit="${handler}" class="space-y-4"><input type="hidden" id="prof-id" value="${isEditing ? professorData.id : ''}"><label class="block"><span class="text-gray-700">Full Name</span><input id="prof-name" type="text" class="mt-1 block w-full p-2 border border-gray-300 rounded-md" value="${professorData?.name || ''}" required></label><label class="block"><span class="text-gray-700">Department</span><input id="prof-department" type="text" class="mt-1 block w-full p-2 border border-gray-300 rounded-md" value="${professorData?.department || ''}" required></label><label class="block"><span class="text-gray-700">Cabin</span><input id="prof-cabin" type="text" class="mt-1 block w-full p-2 border border-gray-300 rounded-md" value="${professorData?.cabin || ''}" required></label><label class="block"><span class="text-gray-700">Status</span><select id="prof-status" class="mt-1 block w-full p-2 border border-gray-300 rounded-md"><option ${professorData?.status === 'Available' ? 'selected' : ''}>Available</option><option ${professorData?.status === 'Not Available' ? 'selected' : ''}>Not Available</option></select></label>${!isTeacherEditing ? `<label class="block"><span class="text-gray-700">Password</span><input id="prof-password" type="text" class="mt-1 block w-full p-2 border border-gray-300 rounded-md" value="${professorData?.password || 'password123'}" required></label>`: ''}<div class="flex justify-end gap-4 pt-4"><button type="button" onclick="actions.closeModal()" class="px-6 py-2 rounded-lg bg-gray-200 hover:bg-gray-300">Cancel</button><button type="submit" class="px-6 py-2 rounded-lg bg-green-500 text-white hover:bg-green-600">${buttonText}</button></div></form></div>`;
                        break;
                }
                modalBox.innerHTML = content;
            }
        };

        // =================================================================================
        // 3. ACTIONS
        // Functions that handle user events and modify the state.
        // After modifying state, they call `render.app()` to update the UI.
        // =================================================================================
        const actions = {
            showPage: (pageId) => {
                state.currentPage = pageId;
                render.app();
            },

            handleLogin: (event, type) => {
                event.preventDefault();
                const name = document.getElementById(`${type}-login-name`).value;
                const password = document.getElementById(`${type}-login-password`).value;
                const errorDiv = document.getElementById(`${type}-login-error`);
                errorDiv.textContent = '';
                
                if (type === 'teacher') {
                    const teacher = state.professors.find(p => p.name.toLowerCase() === name.toLowerCase());
                    if (teacher && password === teacher.password) {
                        state.loggedInUser = teacher;
                        actions.showPage('teacher-dashboard');
                    } else {
                        errorDiv.textContent = 'Invalid name or password.';
                    }
                } else { // Admin
                    if (name === state.adminCredentials.name && password === state.adminCredentials.password) {
                        state.loggedInUser = 'admin';
                        actions.showPage('admin-dashboard');
                    } else {
                        errorDiv.textContent = 'Invalid admin credentials.';
                    }
                }
            },

            logout: () => {
                state.loggedInUser = null;
                actions.closeModal();
                actions.showPage('login-page');
            },

            deleteProfessor: (profId) => {
                state.professors = state.professors.filter(p => p.id !== profId);
                actions.openModal('success', 'Professor has been deleted.');
                render.adminDashboard();
            },

            handleProfessorUpdate: (event, isTeacherEditing = false) => {
                event.preventDefault();
                const idValue = document.getElementById('prof-id').value;
                const id = idValue ? parseInt(idValue, 10) : null;
                
                const formData = {
                    name: document.getElementById('prof-name').value,
                    department: document.getElementById('prof-department').value,
                    cabin: document.getElementById('prof-cabin').value,
                    status: document.getElementById('prof-status').value,
                };

                if (!isTeacherEditing) {
                    const passwordInput = document.getElementById('prof-password');
                    if (passwordInput) formData.password = passwordInput.value;
                }

                if (id) { // Editing
                    const profIndex = state.professors.findIndex(p => p.id === id);
                    if (profIndex !== -1) {
                        state.professors[profIndex] = { ...state.professors[profIndex], ...formData };
                        if (isTeacherEditing) state.loggedInUser = state.professors[profIndex];
                    }
                } else { // Adding
                    formData.id = state.nextProfId++;
                    state.professors.push(formData);
                }
                
                actions.openModal('success', `Professor data has been ${id ? 'updated' : 'added'}.`);
                // Re-render the dashboard that was being viewed
                if (isTeacherEditing) render.teacherDashboard(); else render.adminDashboard();
            },
            
            openModal: (type, id = null) => {
                render.modalContent(type, id);
                const modalContainer = document.getElementById('modal-container');
                modalContainer.classList.remove('hidden');
                modalContainer.classList.add('flex');
            },

            closeModal: () => {
                const modalContainer = document.getElementById('modal-container');
                modalContainer.classList.remove('flex');
                modalContainer.classList.add('hidden');
                document.getElementById('modal-box').innerHTML = '';
            },
        };

        // =================================================================================
        // 4. INITIALIZATION
        // Set up the app when the page loads.
        // =================================================================================
        window.onload = () => {
            // Initial render
            render.app();

            // Programmatically add event listeners to the main portal cards for reliability
            document.getElementById('student-portal-card').addEventListener('click', () => actions.showPage('student-dashboard'));
            document.getElementById('teacher-portal-card').addEventListener('click', () => actions.showPage('teacher-login-page'));
            document.getElementById('admin-portal-card').addEventListener('click', () => actions.showPage('admin-login-page'));
        };

    </script>
</body>
</html>






